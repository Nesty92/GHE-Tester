version: "2"

services:
  nginx:
    image:  nginx:alpine
    ports:
      - "80:80"
    volumes: 
      - ./config/default.conf:/etc/nginx/conf.d/default.conf
      - ./cms/:/var/www/html/
    links:
      - wordpress-fpm:wordpress
      - joomla-fpm:joomla
      - drupal-fpm:drupal
    depends_on:
      - wordpress-fpm
      - joomla-fpm
      - drupal-fpm

  wordpress-fpm:
    image:  wordpress:php7.1-fpm-alpine
    volumes: 
      - ./cms/:/var/www/html/
    links:
      - db:db
    depends_on:
        - "db"

  joomla-fpm:
    image:  joomla:fpm-php7
    volumes: 
      - ./cms/:/var/www/html/
    depends_on:
        - "db"
    environment:
      - JOOMLA_DB_HOST=db
      - JOOMLA_DB_USER=root
      - JOOMLA_DB_PASSWORD=ghe
      - JOOMLA_DB_NAME=joomla

  drupal-fpm:
    image:  drupal:7-fpm-alpine
    volumes: 
      - ./cms/:/var/www/html/
    links:
      - db:db
    depends_on:
        - "db"

  db:
    image:  mysql:5.7
    volumes: 
      - ./mysql/:/var/lib/mysql  
      - ./config/database.sql:/docker-entrypoint-initdb.d/database.sql
    environment:
      - MYSQL_ROOT_PASSWORD=ghe
